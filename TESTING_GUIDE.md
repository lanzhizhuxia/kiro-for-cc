# Sam + Codex 自动化系统测试指南

## 🎯 测试目标

验证 Sam + Codex 自动化协作系统的完整功能。

## 📋 测试准备

### 1. 安装扩展

**方法 A - 使用 F5 调试**（推荐）:
```
1. 在 VSCode 中打开本项目
2. 按 F5 启动扩展开发主机
3. 新窗口会自动加载扩展
```

**方法 B - 手动安装 .vsix**:
```bash
code --install-extension kiro-for-cc-0.6.0.vsix
```

### 2. 检查 Codex MCP Server

```bash
claude mcp list
```

应该看到：
```
codex-cli: ... - ✓ Connected
```

如果未连接，参考 [docs/CODEX_SETUP.md](docs/CODEX_SETUP.md) 配置。

### 3. 测试 Spec 已准备

位置: `.claude/specs/test-automation/`

包含：
- `requirements.md` - 需求文档
- `design.md` - 设计文档
- `tasks.md` - 12个测试任务

## 🧪 测试流程

### 测试 1: 任务评估功能

**步骤**：
1. 打开命令面板 (`Cmd+Shift+P` 或 `Ctrl+Shift+P`)
2. 输入 "Sam: Auto-Evaluate Tasks"
3. 输入 spec 名称: `test-automation`
4. 等待评估完成

**预期结果**：
```
任务评估完成！

总任务数: 12
推荐 Codex: 10 个
建议手动: 2 个

查看详细评估结果？
```

**验证点**：
- ✅ 任务1-10应该推荐 Codex（算法、工具函数、数据处理）
- ✅ 任务11（文档）应该推荐手动
- ✅ 任务12（UI设计）应该推荐手动

**查看详细评估**：
1. 选择"查看详情"
2. 打开输出面板 (View → Output → Kiro for CC)
3. 查看每个任务的评估详情

示例输出：
```
[SamAutomation] Detailed evaluation:
  1. 实现冒泡排序函数: Codex (复杂度: 45, 理由: algorithm任务有明确的输入输出，适合 Codex 自动生成)
  2. 实现字符串反转函数: Codex (复杂度: 25, 理由: 任务简单（25分），Codex 可快速完成)
  ...
  11. 编写详细的API文档: Manual (复杂度: 55, 理由: documentation任务需要人工判断和深度理解现有代码)
  12. 设计美观的界面布局: Manual (复杂度: 60, 理由: UI/UX 任务涉及主观判断，不适合自动化)
```

### 测试 2: 自动实现功能（可选，需要真实 Codex）

⚠️ **注意**: 这会调用真实的 Codex API，可能产生费用。

**步骤**：
1. 打开命令面板
2. 输入 "Sam: Auto-Implement Tasks with Codex"
3. 输入 spec 名称: `test-automation`
4. 确认执行

**预期流程**：
```
1. ⏳ 正在评估任务...
2. 📊 找到 10 个推荐 Codex 的任务
3. 🚀 批量委派给 Codex（最多3个并发）
4. ⏱️  显示实时进度通知
5. ✅ 逐个完成任务
6. 📝 显示 diff 视图（供审查）
7. 🎉 完成报告
```

**预期结果**：
```
自动化完成！

总任务数: 12
委派给 Codex: 10
成功完成: 8-10
失败: 0-2
需要人工: 2

总耗时: 60-120秒
```

**验证点**：
- ✅ 任务并发执行（最多3个同时）
- ✅ 显示进度通知
- ✅ 生成的代码显示在 diff 视图
- ✅ 可以选择接受/合并/拒绝
- ✅ tasks.md 中成功的任务标记为 [x]
- ✅ PROGRESS.md 记录执行报告

### 测试 3: Diff 视图和代码审查

当任务成功生成代码后：

**预期行为**：
1. VSCode 自动打开 diff 视图
2. 左侧：原始文件（如果存在）或空白
3. 右侧：Codex 生成的代码
4. 文件名：`xxx.codex-generated`

**用户选项**：
- **✅ 接受**: 用新代码替换（如果文件不存在则创建）
- **🔀 合并**: 打开两个文件供手动合并
- **❌ 拒绝**: 保留现有文件，删除临时文件

**验证点**：
- ✅ Diff 视图正确显示
- ✅ 代码包含中文注释
- ✅ 类型定义完整
- ✅ 选择"接受"后文件正确创建/更新

### 测试 4: 进度追踪

**验证 tasks.md 更新**：
```bash
cat .claude/specs/test-automation/tasks.md
```

预期：成功的任务从 `- [ ]` 变为 `- [x]`

**验证 PROGRESS.md 创建**：
```bash
cat .claude/specs/test-automation/PROGRESS.md
```

预期内容示例：
```markdown
## Codex 自动化执行 - 2025-01-19T10:30:00.000Z

### 执行摘要
- 总任务数: 10
- 成功完成: 8
- 执行失败: 2
- 需要人工处理: 0

### 完成的任务
- [x] 1. 实现冒泡排序函数
- [x] 2. 实现字符串反转函数
...

### 失败的任务
- [ ] 9. 实现手机号验证 - 原因: 超时
```

## 📊 测试检查清单

### 核心功能

- [ ] ✅ TaskEvaluator 正确解析 tasks.md
- [ ] ✅ 复杂度评估合理（0-100分）
- [ ] ✅ 任务类型识别准确
- [ ] ✅ 推荐规则正确（算法→Codex, 文档→手动）

### 批量执行

- [ ] ✅ 并发控制工作（最多3个）
- [ ] ✅ 进度通知显示
- [ ] ✅ 失败自动重试
- [ ] ✅ 超时控制生效

### 代码验收

- [ ] ✅ 基本代码检查生效
- [ ] ✅ 代码非空验证
- [ ] ✅ 占位符检测

### 代码整合

- [ ] ✅ Diff 视图显示
- [ ] ✅ 文件路径推断合理
- [ ] ✅ 备份文件创建
- [ ] ✅ 用户选择响应正确

### 进度追踪

- [ ] ✅ tasks.md 状态更新
- [ ] ✅ PROGRESS.md 创建
- [ ] ✅ 执行报告完整

## 🐛 已知限制

1. **验收测试简化**
   - 编译检查和测试运行是简化版
   - 无法检测真实的编译错误
   - 后续版本会集成 TypeScript Compiler API

2. **文件路径推断**
   - 基于简单的类名/函数名推断
   - 复杂项目结构可能不准确
   - 建议手动指定 targetPath

3. **并发限制**
   - 固定最多3个并发
   - 无法动态调整
   - 后续版本会添加配置选项

## 📝 测试报告

测试完成后，请记录：

**成功的功能**：
-

**发现的问题**：
-

**改进建议**：
-

**总体评价**：
- ⭐⭐⭐⭐⭐ (1-5星)

---

**测试版本**: v0.6.0
**测试日期**: ___________
**测试人**: ___________
